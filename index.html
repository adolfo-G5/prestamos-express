<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Préstamos Express - Solución Móvil</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(to bottom right, #e0f2f7, #c8e6c9);
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        header {
            background-color: #003366;
            color: #fff;
            padding: 1rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        header h1 {
            margin: 0;
            font-size: 2.2rem;
            color: #FFD700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        header p {
            margin: 0.5rem 0 0;
            font-size: 1.1rem;
            color: #a7d9ff;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        h2 {
            color: #003366;
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }
        
        h3 {
            color: #003366;
            margin-bottom: 1.2rem;
            font-size: 1.4rem;
        }
        
        .progress-bar-container {
            background-color: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        .progress-bar {
            background-color: #007bff;
            height: 100%;
            width: 0%;
            border-radius: 10px;
            transition: width 0.5s ease-in-out;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #555;
            font-size: 1rem;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="number"],
        select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }
        
        .button-primary {
            background-color: #007bff;
            color: #fff;
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }
        
        .button-primary:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        
        .button-primary:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .hidden {
            display: none;
        }
        
        .file-upload-container {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s ease;
            position: relative;
            background: #f9f9f9;
        }
        
        .file-upload-container:hover {
            border-color: #007bff;
            background: #f0f8ff;
        }
        
        .file-upload-container input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }
        
        .file-upload-container img {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .summary-box {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 20px;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .summary-box p {
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }
        
        .summary-box .total {
            font-size: 1.4rem;
            font-weight: bold;
            color: #007bff;
            margin-top: 1rem;
            border-top: 1px dashed #ddd;
            padding-top: 1rem;
        }
        
        .contact-info {
            text-align: center;
            margin-top: 2rem;
            font-size: 1.1rem;
            color: #666;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }
        
        .contact-info a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }
        
        .contact-info a:hover {
            text-decoration: underline;
        }
        
        .radio-group {
            margin: 15px 0;
            display: flex;
            gap: 15px;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: normal;
        }
        
        .radio-group input[type="radio"] {
            margin-right: 5px;
        }
        
        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .family-block {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #eee;
        }
        
        .family-block h4 {
            margin-top: 0;
            color: #003366;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .phone-prefix {
            background: #f0f0f0;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px 0 0 8px;
            display: flex;
            align-items: center;
        }
        
        .phone-container {
            display: flex;
            margin-bottom: 5px;
        }
        
        .phone-container input {
            border-radius: 0 8px 8px 0;
        }
        
        .mobile-warning {
            background: #fff9db;
            border-left: 4px solid #ffd43b;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 4px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        
        .mobile-warning i {
            font-size: 1.2rem;
            margin-right: 10px;
            color: #e67700;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-container {
            background-color: #fff;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal-container {
            transform: translateY(0);
        }
        
        .modal-icon {
            font-size: 50px;
            color: #28a745;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 24px;
            color: #003366;
            margin-bottom: 15px;
        }
        
        .modal-message {
            font-size: 16px;
            color: #555;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .modal-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .modal-button:hover {
            background-color: #0056b3;
        }
        
        /* Nuevos estilos para términos y condiciones */
        #terms {
            background-color: #ffffff;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        #termsContent {
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 10px;
            background: #f9f9f9;
            margin-bottom: 20px;
            text-align: left;
        }
        
        #termsContent h4 {
            color: #003366;
            margin: 15px 0 10px;
        }
        
        #termsContent p {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        #termsContent ul {
            margin-left: 25px;
            margin-bottom: 15px;
        }
        
        #termsContent li {
            margin-bottom: 8px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            h3 {
                font-size: 1.3rem;
            }
            
            .button-primary {
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .file-upload-container {
                padding: 15px;
            }
            
            .file-upload-container p {
                font-size: 0.9rem;
            }
            
            .summary-box {
                padding: 15px;
            }
            
            #termsContent {
                max-height: 300px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 8px;
            }
            
            #termsContent {
                padding: 10px;
                font-size: 0.9rem;
            }
        }
        
        .name-example {
            font-size: 0.85rem;
            color: #666;
            margin-top: 4px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <header>
        <h1>Préstamos Express</h1>
        <p>Tu solución rápida y segura</p>
    </header>

    <div class="container">
        <!-- Sección de Términos y Condiciones -->
        <div id="terms">
            <h2>Términos y Condiciones</h2>
            <div id="termsContent">
                <!-- Contenido editable desde el script -->
                <!-- El contenido real se cargará dinámicamente -->
            </div>
            <button type="button" class="button-primary" id="acceptTerms">Acepto los términos y condiciones</button>
        </div>

        <section id="formSection" class="hidden">
            <h2>Solicita tu préstamo en 2 pasos</h2>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <!-- Paso 1: Datos básicos del usuario -->
            <div id="step1">
                <h3>Paso 1: Datos básicos</h3>
                <div class="mobile-warning">
                    <i>📱</i>
                    <div>En dispositivos móviles: Si tienes problemas para subir fotos, intenta tomarlas directamente con la cámara.</div>
                </div>
                <form id="formStep1" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="phone">Número de celular:</label>
                        <div class="phone-container">
                            <span class="phone-prefix">+507</span>
                            <input type="tel" id="phone" name="phone" placeholder="61234567" maxlength="8" required>
                        </div>
                        <span class="error-message" id="phoneError">Debe ingresar 8 dígitos sin guiones.</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Correo electrónico:</label>
                        <input type="email" id="email" name="email" placeholder="ejemplo@dominio.com" required>
                        <span class="error-message" id="emailError">Correo electrónico inválido.</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="fullName">Nombres y apellidos completos:</label>
                        <input type="text" id="fullName" name="fullName" placeholder="Juan Carlos Pérez García" required>
                        <span class="error-message" id="fullNameError">Debe ingresar primer nombre, segundo nombre, primer apellido y segundo apellido.</span>
                        <div class="name-example">Ejemplo: Juan Carlos Pérez García</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="cedula">Número de cédula:</label>
                        <input type="text" id="cedula" name="cedula" placeholder="Ej: 1-1234-12345" required>
                        <span class="error-message" id="cedulaError">Formato de cédula inválido (ej: 1-123-12, 1-1234-1234, 12-1234-1234).</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="cedulaFront">Foto frontal de la cédula:</label>
                        <div class="file-upload-container" id="cedulaFrontUpload">
                            <input type="file" id="cedulaFront" name="cedula_frontal" accept="image/*" capture="environment" required>
                            <p>Haz clic para subir o tomar foto del frente de la cédula</p>
                            <img id="cedulaFrontPreview" src="#" alt="Previsualización de cédula frontal">
                        </div>
                        <span class="error-message" id="cedulaFrontError">Debes subir una foto frontal de tu cédula.</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="cedulaBack">Foto trasera de la cédula:</label>
                        <div class="file-upload-container" id="cedulaBackUpload">
                            <input type="file" id="cedulaBack" name="cedula_trasera" accept="image/*" capture="environment" required>
                            <p>Haz clic para subir o tomar foto del reverso de la cédula</p>
                            <img id="cedulaBackPreview" src="#" alt="Previsualización de cédula trasera">
                        </div>
                        <span class="error-message" id="cedulaBackError">Debes subir una foto trasera de tu cédula.</span>
                    </div>
                    
                    <button type="button" class="button-primary" id="continueToStep2" disabled>Continuar al Paso 2</button>
                </form>
            </div>
            
            <!-- Paso 2: Detalles del préstamo -->
            <div id="step2" class="hidden">
                <h3>Paso 2: Detalles del préstamo</h3>
                <div class="summary-box">
                    <p><strong>Monto disponible para ti:</strong> $<span id="availableAmountDisplay">80</span></p>
                    <p><strong>Plazos disponibles:</strong> <span id="availableTermsDisplay"></span></p>
                    <p><strong>Formas de pago:</strong> <span id="paymentMethodsDisplay"></span></p>
                    <p><strong>Valor mínimo de garantía:</strong> $<span id="minGuaranteeDisplay"></span></p>
                </div>

                <form id="formStep2" method="POST" enctype="multipart/form-data" action="https://formsubmit.co/foking5.7r@gmail.com">
                    <!-- Campos ocultos para datos del paso 1 -->
                    <input type="hidden" id="hiddenPhone" name="telefono">
                    <input type="hidden" id="hiddenEmail" name="correo_electronico">
                    <input type="hidden" id="hiddenFullName" name="nombre_completo">
                    <input type="hidden" id="hiddenCedula" name="cedula">
                    
                    <div class="form-group">
                        <label for="loanAmount">Monto del préstamo:</label>
                        <input type="range" id="loanAmount" name="monto_prestamo" min="15" max="80" value="50" step="5">
                        <p>Monto seleccionado: $<span id="selectedLoanAmount">50</span></p>
                    </div>
                    
                    <div class="form-group">
                        <label for="loanTerm">Plazo del préstamo:</label>
                        <select id="loanTerm" name="plazo_prestamo"></select>
                    </div>
                    
                    <div class="form-group">
                        <label for="paymentMethod">Forma de pago:</label>
                        <select id="paymentMethod" name="forma_pago"></select>
                    </div>
                    
                    <div class="form-group">
                        <label for="assetValue">Valor del bien en garantía ($):</label>
                        <input type="number" id="assetValue" name="valor_bien_garantia" min="0" step="0.01" required>
                        <span class="error-message" id="assetValueError">El valor del bien no puede ser menor al mínimo de garantía.</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="assetCondition">Estado del bien, tiempo de uso y detalles:</label>
                        <textarea id="assetCondition" name="estado_bien" rows="4" required></textarea>
                        <span class="error-message" id="assetConditionError">Debes describir el estado del bien.</span>
                    </div>
                    
                    <div class="form-group">
                        <label>¿Tienes factura de compra del bien?</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="tiene_factura" value="si" required> Sí
                            </label>
                            <label>
                                <input type="radio" name="tiene_factura" value="no"> No
                            </label>
                        </div>
                        <span class="error-message" id="hasInvoiceError">Debes seleccionar una opción.</span>
                    </div>
                    
                    <div class="form-group" id="invoicePhotoGroup" style="display: none;">
                        <label for="invoicePhoto">Foto de la factura de compra:</label>
                        <div class="file-upload-container" id="invoicePhotoUpload">
                            <input type="file" id="invoicePhoto" name="foto_factura" accept="image/*" capture="environment">
                            <p>Haz clic para subir o tomar foto de la factura</p>
                            <img id="invoicePhotoPreview" src="#" alt="Previsualización de factura">
                        </div>
                        <span class="error-message" id="invoicePhotoError">Debes subir una foto de la factura.</span>
                    </div>
                    
                    <!-- Campos para subir fotos del bien en garantía -->
                    <div class="form-group">
                        <label for="assetPhoto1">Foto 1 del bien en garantía:</label>
                        <div class="file-upload-container" id="assetPhoto1Upload">
                            <input type="file" id="assetPhoto1" name="foto_bien_1" accept="image/*" capture="environment" required>
                            <p>Haz clic para subir o tomar foto del bien</p>
                            <img id="assetPhoto1Preview" src="#" alt="Previsualización de foto del bien 1">
                        </div>
                        <span class="error-message" id="assetPhoto1Error">Debes subir al menos una foto del bien.</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="assetPhoto2">Foto 2 del bien en garantía:</label>
                        <div class="file-upload-container" id="assetPhoto2Upload">
                            <input type="file" id="assetPhoto2" name="foto_bien_2" accept="image/*" capture="environment">
                            <p>Haz clic para subir o tomar foto del bien</p>
                            <img id="assetPhoto2Preview" src="#" alt="Previsualización de foto del bien 2">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="assetPhoto3">Foto 3 del bien en garantía:</label>
                        <div class="file-upload-container" id="assetPhoto3Upload">
                            <input type="file" id="assetPhoto3" name="foto_bien_3" accept="image/*" capture="environment">
                            <p>Haz clic para subir o tomar foto del bien</p>
                            <img id="assetPhoto3Preview" src="#" alt="Previsualización de foto del bien 3">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="assetPhoto4">Foto 4 del bien en garantía:</label>
                        <div class="file-upload-container" id="assetPhoto4Upload">
                            <input type="file" id="assetPhoto4" name="foto_bien_4" accept="image/*" capture="environment">
                            <p>Haz clic para subir o tomar foto del bien</p>
                            <img id="assetPhoto4Preview" src="#" alt="Previsualización de foto del bien 4">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="assetPhoto5">Foto 5 del bien en garantía:</label>
                        <div class="file-upload-container" id="assetPhoto5Upload">
                            <input type="file" id="assetPhoto5" name="foto_bien_5" accept="image/*" capture="environment">
                            <p>Haz clic para subir o tomar foto del bien</p>
                            <img id="assetPhoto5Preview" src="#" alt="Previsualización de foto del bien 5">
                        </div>
                    </div>

                    <!-- Bloque para familiares de referencia -->
                    <div class="family-block">
                        <h4>Familiar de referencia #1</h4>
                        <div class="form-group">
                            <label for="relative1Name">Nombre completo:</label>
                            <input type="text" id="relative1Name" name="familiar1_nombre" placeholder="María Luisa Rodríguez López" required>
                            <span class="error-message" id="relative1NameError">Debe ingresar primer nombre, segundo nombre, primer apellido y segundo apellido.</span>
                            <div class="name-example">Ejemplo: María Luisa Rodríguez López</div>
                        </div>
                        <div class="form-group">
                            <label for="relative1Address">Dirección donde vive:</label>
                            <input type="text" id="relative1Address" name="familiar1_direccion" required>
                        </div>
                        <div class="form-group">
                            <label for="relative1Phone">Número de teléfono:</label>
                            <div class="phone-container">
                                <span class="phone-prefix">+507</span>
                                <input type="tel" id="relative1Phone" name="familiar1_telefono" placeholder="61234567" maxlength="8" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="relative1Relationship">Parentesco:</label>
                            <input type="text" id="relative1Relationship" name="familiar1_parentesco" required>
                        </div>
                        <div class="form-group">
                            <label for="relative1Cedula">Cédula:</label>
                            <input type="text" id="relative1Cedula" name="familiar1_cedula" placeholder="Ej: 1-1234-12345" required>
                        </div>
                    </div>

                    <div class="family-block">
                        <h4>Familiar de referencia #2</h4>
                        <div class="form-group">
                            <label for="relative2Name">Nombre completo:</label>
                            <input type="text" id="relative2Name" name="familiar2_nombre" placeholder="Carlos Alberto Martínez Sánchez" required>
                            <span class="error-message" id="relative2NameError">Debe ingresar primer nombre, segundo nombre, primer apellido y segundo apellido.</span>
                            <div class="name-example">Ejemplo: Carlos Alberto Martínez Sánchez</div>
                        </div>
                        <div class="form-group">
                            <label for="relative2Address">Dirección donde vive:</label>
                            <input type="text" id="relative2Address" name="familiar2_direccion" required>
                        </div>
                        <div class="form-group">
                            <label for="relative2Phone">Número de teléfono:</label>
                            <div class="phone-container">
                                <span class="phone-prefix">+507</span>
                                <input type="tel" id="relative2Phone" name="familiar2_telefono" placeholder="61234567" maxlength="8" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="relative2Relationship">Parentesco:</label>
                            <input type="text" id="relative2Relationship" name="familiar2_parentesco" required>
                        </div>
                        <div class="form-group">
                            <label for="relative2Cedula">Cédula:</label>
                            <input type="text" id="relative2Cedula" name="familiar2_cedula" placeholder="Ej: 1-1234-12345" required>
                        </div>
                    </div>

                    <!-- Resumen del cálculo del préstamo -->
                    <div class="summary-box">
                        <h4>Resumen de tu préstamo:</h4>
                        <p>Monto solicitado: <strong>$<span id="summaryAmount">0.00</span></strong></p>
                        <p>Interés (<span id="summaryInterestRate">0</span>%): <strong>$<span id="summaryInterest">0.00</span></strong></p>
                        <p>Fecha de vencimiento: <strong><span id="summaryDueDate"></span></strong></p>
                        <p class="total">Total a pagar: <strong>$<span id="summaryTotal">0.00</span></strong></p>
                    </div>

                    <!-- Configuración adicional de Formsubmit -->
                    <input type="hidden" name="_subject" value="Nueva solicitud de préstamo">
                    <input type="hidden" name="_template" value="table">
                    <input type="hidden" name="_captcha" value="false">
                    <input type="hidden" name="_next" value="">
                    <input type="hidden" name="_language" value="es">

                    <button type="submit" class="button-primary" id="submitLoan" disabled>Solicitar Préstamo</button>
                </form>
            </div>
        </section>

        <!-- Información de contacto al final de la página -->
        <div class="contact-info">
            <p>¿Necesitas ayuda? Contáctanos:</p>
            <p>Email: <a href="mailto:tu@correo.com" id="adminEmailLink">tu@correo.com</a></p>
            <p>WhatsApp: <a href="https://wa.me/+50712345678" target="_blank" id="adminWhatsappLink">+50712345678</a></p>
        </div>
    </div>
    
    <!-- Modal de confirmación -->
    <div class="modal-overlay" id="confirmationModal">
        <div class="modal-container">
            <div class="modal-icon">✅</div>
            <h3 class="modal-title">¡Solicitud Recibida!</h3>
            <p class="modal-message">Gracias. Con la misma información brindada lo estaremos contactando por sus medios inmediatamente validemos su solicitud de préstamo. Un asesor especializado se pondrá en contacto con usted en seguida.</p>
            <button class="modal-button" id="closeModalButton">Cerrar</button>
        </div>
    </div>

    <script>
    // Configuración
    const config = {
        montoMinimoPrestamo: 15,
        montoMaximoPrestamo: 200,
        rangosInteres: [
            { min: 15, max: 75, tasas: { 15: 33, 30: 66 } },
            { min: 76, max: 150, tasas: { 15: 25, 30: 50 } },
            { min: 151, max: 200, tasas: { 15: 20, 30: 40 } }
        ],
        formasDePago: ["Pago único"],
        porcentajeGarantia: 20,
        emailAdministrador: "foking5.7r@gmail.com",
        whatsappAdministrador: "+50762387994"
    };

    // Almacén para mantener las fotos subidas
    const uploadedFiles = {
        cedulaFront: null,
        cedulaBack: null,
        invoicePhoto: null,
        assetPhotos: []
    };

    let capitalDisponible = 80;

    // Elementos del DOM
    const progressBar = document.getElementById('progressBar');
    const termsSection = document.getElementById('terms');
    const formSection = document.getElementById('formSection');
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const continueToStep2Btn = document.getElementById('continueToStep2');
    const phoneInput = document.getElementById('phone');
    const emailInput = document.getElementById('email');
    const fullNameInput = document.getElementById('fullName');
    const cedulaInput = document.getElementById('cedula');
    const cedulaFrontInput = document.getElementById('cedulaFront');
    const cedulaBackInput = document.getElementById('cedulaBack');
    const cedulaFrontPreview = document.getElementById('cedulaFrontPreview');
    const cedulaBackPreview = document.getElementById('cedulaBackPreview');
    const hiddenPhone = document.getElementById('hiddenPhone');
    const hiddenEmail = document.getElementById('hiddenEmail');
    const hiddenFullName = document.getElementById('hiddenFullName');
    const hiddenCedula = document.getElementById('hiddenCedula');
    const phoneError = document.getElementById('phoneError');
    const emailError = document.getElementById('emailError');
    const fullNameError = document.getElementById('fullNameError');
    const cedulaError = document.getElementById('cedulaError');
    const cedulaFrontError = document.getElementById('cedulaFrontError');
    const cedulaBackError = document.getElementById('cedulaBackError');
    const availableAmountDisplay = document.getElementById('availableAmountDisplay');
    const availableTermsDisplay = document.getElementById('availableTermsDisplay');
    const paymentMethodsDisplay = document.getElementById('paymentMethodsDisplay');
    const minGuaranteeDisplay = document.getElementById('minGuaranteeDisplay');
    const loanAmountInput = document.getElementById('loanAmount');
    const selectedLoanAmountDisplay = document.getElementById('selectedLoanAmount');
    const loanTermSelect = document.getElementById('loanTerm');
    const paymentMethodSelect = document.getElementById('paymentMethod');
    const submitLoanBtn = document.getElementById('submitLoan');
    const assetValueInput = document.getElementById('assetValue');
    const assetConditionInput = document.getElementById('assetCondition');
    const hasInvoiceRadios = document.querySelectorAll('input[name="tiene_factura"]');
    const invoicePhotoGroup = document.getElementById('invoicePhotoGroup');
    const invoicePhotoInput = document.getElementById('invoicePhoto');
    const invoicePhotoPreview = document.getElementById('invoicePhotoPreview');
    const assetPhoto1Input = document.getElementById('assetPhoto1');
    const assetPhoto2Input = document.getElementById('assetPhoto2');
    const assetPhoto3Input = document.getElementById('assetPhoto3');
    const assetPhoto4Input = document.getElementById('assetPhoto4');
    const assetPhoto5Input = document.getElementById('assetPhoto5');
    const assetPhoto1Preview = document.getElementById('assetPhoto1Preview');
    const assetPhoto2Preview = document.getElementById('assetPhoto2Preview');
    const assetPhoto3Preview = document.getElementById('assetPhoto3Preview');
    const assetPhoto4Preview = document.getElementById('assetPhoto4Preview');
    const assetPhoto5Preview = document.getElementById('assetPhoto5Preview');
    const assetPhoto1Error = document.getElementById('assetPhoto1Error');
    const relative1Name = document.getElementById('relative1Name');
    const relative1Address = document.getElementById('relative1Address');
    const relative1Phone = document.getElementById('relative1Phone');
    const relative1Relationship = document.getElementById('relative1Relationship');
    const relative1Cedula = document.getElementById('relative1Cedula');
    const relative2Name = document.getElementById('relative2Name');
    const relative2Address = document.getElementById('relative2Address');
    const relative2Phone = document.getElementById('relative2Phone');
    const relative2Relationship = document.getElementById('relative2Relationship');
    const relative2Cedula = document.getElementById('relative2Cedula');
    const assetValueError = document.getElementById('assetValueError');
    const assetConditionError = document.getElementById('assetConditionError');
    const hasInvoiceError = document.getElementById('hasInvoiceError');
    const invoicePhotoError = document.getElementById('invoicePhotoError');
    const relative1NameError = document.getElementById('relative1NameError');
    const relative2NameError = document.getElementById('relative2NameError');
    const summaryAmount = document.getElementById('summaryAmount');
    const summaryInterestRate = document.getElementById('summaryInterestRate');
    const summaryInterest = document.getElementById('summaryInterest');
    const summaryDueDate = document.getElementById('summaryDueDate');
    const summaryTotal = document.getElementById('summaryTotal');
    const adminEmailLink = document.getElementById('adminEmailLink');
    const adminWhatsappLink = document.getElementById('adminWhatsappLink');
    const confirmationModal = document.getElementById('confirmationModal');
    const closeModalButton = document.getElementById('closeModalButton');
    const acceptTermsBtn = document.getElementById('acceptTerms');
    const termsContent = document.getElementById('termsContent');

    // Inicializar la barra de progreso
    progressBar.style.width = '0%';

    // Función para mostrar el modal de confirmación
    function showConfirmationModal() {
        confirmationModal.classList.add('active');
        setTimeout(() => {
            confirmationModal.classList.remove('active');
        }, 5000);
    }

    closeModalButton.addEventListener('click', () => {
        confirmationModal.classList.remove('active');
    });

    // Funciones de validación
    function validatePhone(phone) {
        return /^\d{8}$/.test(phone);
    }

    function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function validateCedula(cedula) {
        return /^\d{1,2}-\d{3,4}-\d{2,4}$/.test(cedula);
    }

    function validateFullName(name) {
        // Validar que tenga al menos 4 palabras (primer nombre, segundo nombre, primer apellido, segundo apellido)
        return name.trim().split(/\s+/).length >= 4;
    }

    function toggleError(element, show) {
        element.style.display = show ? 'block' : 'none';
    }

    function validateStep1() {
        const isPhoneValid = validatePhone(phoneInput.value);
        const isEmailValid = validateEmail(emailInput.value);
        const isFullNameValid = validateFullName(fullNameInput.value);
        const isCedulaValid = validateCedula(cedulaInput.value);
        const isCedulaFrontUploaded = uploadedFiles.cedulaFront !== null;
        const isCedulaBackUploaded = uploadedFiles.cedulaBack !== null;

        toggleError(phoneError, !isPhoneValid);
        toggleError(emailError, !isEmailValid);
        toggleError(fullNameError, !isFullNameValid);
        toggleError(cedulaError, !isCedulaValid);
        toggleError(cedulaFrontError, !isCedulaFrontUploaded);
        toggleError(cedulaBackError, !isCedulaBackUploaded);

        continueToStep2Btn.disabled = !(isPhoneValid && isEmailValid && isFullNameValid && 
                                     isCedulaValid && isCedulaFrontUploaded && isCedulaBackUploaded);
    }

    function validateStep2() {
        const minGuarantee = parseFloat(minGuaranteeDisplay.textContent) || 0;
        const assetValue = parseFloat(assetValueInput.value);
        const isAssetValueValid = !isNaN(assetValue) && assetValue >= minGuarantee;
        const isAssetConditionValid = assetConditionInput.value.trim() !== '';
        const isHasInvoiceSelected = document.querySelector('input[name="tiene_factura"]:checked') !== null;
        const isInvoicePhotoValid = hasInvoiceRadios[0].checked ? uploadedFiles.invoicePhoto !== null : true;
        const isAssetPhotosValid = uploadedFiles.assetPhotos.length > 0;

        // Validar campos de familiares
        const isRelative1NameValid = validateFullName(relative1Name.value);
        const isRelative2NameValid = validateFullName(relative2Name.value);

        toggleError(assetValueError, !isAssetValueValid);
        toggleError(assetConditionError, !isAssetConditionValid);
        toggleError(hasInvoiceError, !isHasInvoiceSelected);
        toggleError(invoicePhotoError, hasInvoiceRadios[0].checked && !isInvoicePhotoValid);
        toggleError(assetPhoto1Error, !isAssetPhotosValid);
        toggleError(relative1NameError, !isRelative1NameValid);
        toggleError(relative2NameError, !isRelative2NameValid);

        submitLoanBtn.disabled = !(isAssetValueValid && isAssetConditionValid && isHasInvoiceSelected && 
                                 isInvoicePhotoValid && isAssetPhotosValid && isRelative1NameValid && isRelative2NameValid);
    }

    function calcularMinimoGarantia(monto) {
        return monto + (monto * (config.porcentajeGarantia / 100));
    }

    function initializeStep2() {
        loanAmountInput.min = config.montoMinimoPrestamo;
        loanAmountInput.max = capitalDisponible;
        loanAmountInput.value = Math.max(config.montoMinimoPrestamo, Math.min(50, capitalDisponible));
        availableAmountDisplay.textContent = capitalDisponible;
        
        const initialMinGuarantee = calcularMinimoGarantia(parseFloat(loanAmountInput.value));
        minGuaranteeDisplay.textContent = initialMinGuarantee.toFixed(2);
        assetValueInput.min = initialMinGuarantee;

        // Cargar plazos disponibles
        loanTermSelect.innerHTML = '';
        const termsText = [];
        const plazosDisponibles = [15, 30];
        
        plazosDisponibles.forEach(dias => {
            const option = document.createElement('option');
            option.value = dias;
            option.textContent = dias + ' días';
            loanTermSelect.appendChild(option);
            termsText.push(dias + ' días');
        });
        
        availableTermsDisplay.textContent = termsText.join(', ');

        // Cargar formas de pago
        paymentMethodSelect.innerHTML = '';
        config.formasDePago.forEach(metodo => {
            const option = document.createElement('option');
            option.value = metodo;
            option.textContent = metodo;
            paymentMethodSelect.appendChild(option);
        });
        paymentMethodsDisplay.textContent = config.formasDePago.join(', ');

        adminEmailLink.href = 'mailto:' + config.emailAdministrador;
        adminEmailLink.textContent = config.emailAdministrador;
        adminWhatsappLink.href = 'https://wa.me/' + config.whatsappAdministrador.replace('+', '');
        adminWhatsappLink.textContent = config.whatsappAdministrador;
    }
    
    function updateLoanSummary() {
        const amount = parseFloat(loanAmountInput.value);
        const selectedTermDays = parseInt(loanTermSelect.value);

        if (amount < config.montoMinimoPrestamo || amount > capitalDisponible) {
            submitLoanBtn.disabled = true;
            alert('El monto debe estar entre $' + config.montoMinimoPrestamo + ' y $' + capitalDisponible);
            return;
        }

        // Calcular tasa de interés
        const rango = config.rangosInteres.find(r => amount >= r.min && amount <= r.max);
        const interestRate = rango ? rango.tasas[selectedTermDays] : 0;
        
        const interest = amount * (interestRate / 100);
        const totalToPay = amount + interest;

        const dueDate = new Date();
        dueDate.setDate(dueDate.getDate() + selectedTermDays);
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        const formattedDueDate = dueDate.toLocaleDateString('es-ES', options);

        selectedLoanAmountDisplay.textContent = amount.toFixed(2);
        summaryAmount.textContent = amount.toFixed(2);
        summaryInterestRate.textContent = interestRate;
        summaryInterest.textContent = interest.toFixed(2);
        summaryDueDate.textContent = formattedDueDate;
        summaryTotal.textContent = totalToPay.toFixed(2);
        
        const minGuarantee = calcularMinimoGarantia(amount);
        minGuaranteeDisplay.textContent = minGuarantee.toFixed(2);
        assetValueInput.min = minGuarantee;
    }

    // SOLUCIÓN PARA MÚLTIPLES FOTOS: Manejar subida de archivos
    function handleFileUpload(input, preview, errorElement, fileType, index = null) {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
                
                // Almacenar el archivo según el tipo
                if (fileType === 'cedulaFront') {
                    uploadedFiles.cedulaFront = file;
                } else if (fileType === 'cedulaBack') {
                    uploadedFiles.cedulaBack = file;
                } else if (fileType === 'invoice') {
                    uploadedFiles.invoicePhoto = file;
                } else if (fileType === 'asset' && index !== null) {
                    uploadedFiles.assetPhotos[index] = file;
                }
                
                // Validar paso correspondiente
                if (fileType === 'cedulaFront' || fileType === 'cedulaBack') {
                    validateStep1();
                } else {
                    validateStep2();
                }
                
                // Workaround para iOS: forzar actualización del input
                const temp = input.value;
                input.value = '';
                input.value = temp;
            };
            reader.readAsDataURL(file);
        }
    }

    // Configurar eventos para inputs de archivo
    cedulaFrontInput.addEventListener('change', () => {
        handleFileUpload(cedulaFrontInput, cedulaFrontPreview, cedulaFrontError, 'cedulaFront');
    });

    cedulaBackInput.addEventListener('change', () => {
        handleFileUpload(cedulaBackInput, cedulaBackPreview, cedulaBackError, 'cedulaBack');
    });

    // Event Listeners para fotos del bien
    const assetPhotoInputs = [assetPhoto1Input, assetPhoto2Input, assetPhoto3Input, assetPhoto4Input, assetPhoto5Input];
    const assetPhotoPreviews = [assetPhoto1Preview, assetPhoto2Preview, assetPhoto3Preview, assetPhoto4Preview, assetPhoto5Preview];
    
    assetPhotoInputs.forEach((input, index) => {
        input.addEventListener('change', () => {
            handleFileUpload(input, assetPhotoPreviews[index], assetPhoto1Error, 'asset', index);
        });
    });

    // Event Listeners para fotos de factura
    invoicePhotoInput.addEventListener('change', () => {
        handleFileUpload(invoicePhotoInput, invoicePhotoPreview, invoicePhotoError, 'invoice');
    });

    // Resto de event listeners
    phoneInput.addEventListener('input', function() {
        this.value = this.value.replace(/\D/g, '').slice(0, 8);
        validateStep1();
    });

    emailInput.addEventListener('input', validateStep1);
    fullNameInput.addEventListener('input', validateStep1);
    cedulaInput.addEventListener('input', validateStep1);

    assetValueInput.addEventListener('input', validateStep2);
    assetConditionInput.addEventListener('input', validateStep2);
    
    hasInvoiceRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            invoicePhotoGroup.style.display = this.value === 'si' ? 'block' : 'none';
            validateStep2();
        });
    });

    // Eventos para campos de familiares
    [relative1Name, relative1Address, relative1Relationship, relative1Cedula,
     relative2Name, relative2Address, relative2Relationship, relative2Cedula].forEach(field => {
        field.addEventListener('input', validateStep2);
    });

    // Validación de teléfono para familiares
    [relative1Phone, relative2Phone].forEach(phoneField => {
        phoneField.addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '').slice(0, 8);
            validateStep2();
        });
    });

    continueToStep2Btn.addEventListener('click', () => {
        if (!continueToStep2Btn.disabled) {            
            hiddenPhone.value = '+507' + phoneInput.value;
            hiddenEmail.value = emailInput.value;
            hiddenFullName.value = fullNameInput.value;
            hiddenCedula.value = cedulaInput.value;
                    
            step1.classList.add('hidden');
            step2.classList.remove('hidden');
            progressBar.style.width = '100%';
            initializeStep2();
            updateLoanSummary();
            validateStep2();
        }
    });

    loanAmountInput.addEventListener('input', function() {
        updateLoanSummary();
        validateStep2();
    });
    
    loanTermSelect.addEventListener('change', function() {
        updateLoanSummary();
        validateStep2();
    });
    
    document.getElementById('formStep2').addEventListener('submit', async (e) => {
        e.preventDefault();
        validateStep2();
        
        if (submitLoanBtn.disabled) {
            alert('Por favor complete todos los campos requeridos correctamente.');
            return;
        }
        
        showConfirmationModal();
        
        try {
            const form = e.target;
            const formData = new FormData(form);
            
            // Agregar archivos almacenados al FormData
            if (uploadedFiles.cedulaFront) formData.append('cedula_frontal', uploadedFiles.cedulaFront);
            if (uploadedFiles.cedulaBack) formData.append('cedula_trasera', uploadedFiles.cedulaBack);
            if (uploadedFiles.invoicePhoto) formData.append('foto_factura', uploadedFiles.invoicePhoto);
            
            // Agregar fotos de bienes
            uploadedFiles.assetPhotos.forEach((file, index) => {
                if (file) formData.append(`foto_bien_${index+1}`, file);
            });
            
            // Agregar datos calculados al FormData
            formData.append('total_a_pagar', document.getElementById('summaryTotal').textContent);
            formData.append('fecha_pago', document.getElementById('summaryDueDate').textContent);
            formData.append('intereses', document.getElementById('summaryInterest').textContent);
            
            const response = await fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            });
            
            if (response.ok) {
                // Limpiar formulario después del envío exitoso
                form.reset();
                document.getElementById('formStep1').reset();
                
                // Limpiar previsualizaciones de imágenes
                [cedulaFrontPreview, cedulaBackPreview, invoicePhotoPreview, 
                 assetPhoto1Preview, assetPhoto2Preview, assetPhoto3Preview, 
                 assetPhoto4Preview, assetPhoto5Preview].forEach(preview => {
                    preview.src = '#';
                    preview.style.display = 'none';
                });
                
                // Resetear almacenamiento de archivos
                uploadedFiles.cedulaFront = null;
                uploadedFiles.cedulaBack = null;
                uploadedFiles.invoicePhoto = null;
                uploadedFiles.assetPhotos = [];
                
                // Volver al paso 1
                setTimeout(() => {
                    step2.classList.add('hidden');
                    step1.classList.remove('hidden');
                    progressBar.style.width = '0%';
                }, 3000);
            } else {
                console.error('Error al enviar el formulario');
                alert('Hubo un error al enviar tu solicitud. Por favor intenta nuevamente.');
            }
        } catch (error) {
            console.error('Error al enviar el formulario:', error);
            alert('Hubo un error al enviar tu solicitud. Por favor intenta nuevamente.');
        }
    });

    // Función para cargar términos y condiciones (editable)
    function loadTermsContent() {
        termsContent.innerHTML = `
            <h4>Condiciones Generales</h4>
            <p>Al aceptar estos términos y condiciones, usted reconoce haber leído y comprendido las siguientes condiciones que rigen el uso de nuestro servicio de préstamos express.</p>
            
            <h4>Responsabilidades del Usuario</h4>
            <p>Usted se compromete a:</p>
            <ul>
                <li>Proporcionar información veraz y actualizada en el formulario de solicitud</li>
                <li>Mantener la confidencialidad de su información de acceso</li>
                <li>Utilizar el servicio únicamente para fines legales</li>
                <li>Pagar el préstamo en los plazos y condiciones establecidos</li>
            </ul>
            
            <h4>Derechos de la Plataforma</h4>
            <p>Nos reservamos el derecho de:</p>
            <ul>
                <li>Rechazar solicitudes que no cumplan con nuestros criterios de aprobación</li>
                <li>Suspender o cancelar cuentas que violen nuestros términos</li>
                <li>Modificar las condiciones de los préstamos con previo aviso</li>
                <li>Verificar la información proporcionada por el usuario</li>
            </ul>
            
            <h4>Privacidad y Protección de Datos</h4>
            <p>Toda la información personal proporcionada será tratada conforme a nuestra Política de Privacidad, disponible en nuestro sitio web. Nos comprometemos a proteger sus datos y a utilizarlos únicamente para los fines establecidos.</p>
            
            <h4>Tarifas e Intereses</h4>
            <p>Los intereses y tarifas aplicables a cada préstamo se detallarán en el contrato específico que se le presentará antes de la aprobación final. Asegúrese de comprender todas las condiciones antes de aceptar el préstamo.</p>
            
            <h4>Plazos de Pago</h4>
            <p>Los plazos de pago se establecerán según el monto del préstamo y las condiciones acordadas. El incumplimiento en los pagos generará intereses moratorios según lo establecido en el contrato.</p>
            
            <h4>Modificaciones</h4>
            <p>Estos términos y condiciones pueden ser modificados periódicamente. Se le notificará sobre cambios significativos mediante los canales de contacto proporcionados.</p>
        `;
    }

    // Evento para aceptar términos
    acceptTermsBtn.addEventListener('click', () => {
        termsSection.classList.add('hidden');
        formSection.classList.remove('hidden');
        progressBar.style.width = '0%';
    });

    // Inicialización
    document.addEventListener('DOMContentLoaded', () => {
        loadTermsContent();
        validateStep1();
        initializeStep2();
        updateLoanSummary();
        progressBar.style.width = '0%';
        
        // Configurar el prefijo +507 en los teléfonos de familiares
        [relative1Phone, relative2Phone].forEach(input => {
            input.value = '';
        });
        
        // Mensaje para móviles
        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            console.log("Modo móvil activado - Solución iOS implementada");
        }
    });
</script>
</body>
</html>